pipeline {
    agent any

    parameters {
        string(
            name: 'GIT_REPO_URL',
            defaultValue: 'https://github.com/username/repo.git',
            description: 'Git repository URL'
        )

        string(
            name: 'GIT_BRANCH',
            defaultValue: 'main',
            description: 'Git branch to checkout'
        )

        string(
            name: 'JAVA_FILE',
            defaultValue: 'HelloWorld.java',
            description: 'Java source file name'
        )
    }

    environment {
        JAVA_HOME = "/opt/jdk21"
        PATH = "${JAVA_HOME}/bin:${env.PATH}"
    }

    stages {

        stage('Clone Repository') {
            steps {
                echo "Cloning repository: ${params.GIT_REPO_URL}"
                git branch: "${params.GIT_BRANCH}", url: "${params.GIT_REPO_URL}"
            }
        }

        stage('Build Java Program') {
            steps {
                echo "Compiling ${params.JAVA_FILE}"
                sh "javac ${params.JAVA_FILE}"
            }
        }

        stage('Run Java Program') {
            steps {
                script {
                    def className = params.JAVA_FILE.replace('.java', '')
                    echo "Running ${className}"
                    sh "java ${className}"
                }
            }
        }
    }

    post {
        success {
            echo "✅ Pipeline executed successfully!"
        }
        failure {
            echo "❌ Pipeline failed. Please check logs."
        }
    }
}
